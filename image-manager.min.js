/*! ImageManager.js - v0.1.0 - 2014-06-16
* http://gustavocarvalho.eti.br/image-manager.js
* Copyright (c) 2014 Gustavo Carvalho; Licensed under MIT */
!function(a){"use strict";function b(b,c){var d=function(){},e="[JSDebugger]";if(this.error=d,this.info=d,this.log=d,this.warn=d,!a.console||"undefined"==typeof a.console)return this;switch(c){case 0:return this.error=d,this.info=d,this.log=d,this.warn=d,this;case 1:return console.info(e,b,"MODE: Logs and Info only"),this.error=d,this.info=console.info.bind(console,b),this.log=console.log.bind(console,b),this.warn=d,this;case 2:return console.info(e,b,"MODE: Errors only"),this.error=console.error.bind(console,b),this.info=d,this.log=d,this.warn=d,this;default:return console.info(e,b,"MODE: Verbose"),this.error=console.error.bind(console,b),this.info=console.info.bind(console,b),this.log=console.log.bind(console,b),this.warn=console.warn.bind(console,b),this}}function c(){var a=0;this.generate=function(){return a+=1}}var d=function(a){function d(a){n.log("Ending load process:",a),s.hasOwnProperty(a)&&(s[a].clear(),s[a]=null,delete s[a],t-=1)}function e(){function b(b,c,o){h+=1,p[b]=g[b],q+=1,n.log(g[b].src,"  loaded"),o.call(p[b]),l.call(a,e.getProgress()),h===i?(k=!1,d(f),n.log("Load process",f,"done with no errors."),m.call(a,{code:1,errors:0})):h+j===i&&(k=!1,d(f),n.warn("Load process",f,"done with",j,"errors"),m.call(a,{code:0,errors:j}))}function c(c){var e=null,l=null,o=u,q=u;if(!c.name||"string"!=typeof c.name)throw new Error("Missing or invalid name property. Check your image(s) object(s)");if(e=c.name,p.hasOwnProperty(e)&&n.warn("Duplicated names found. Overwriting",e),!c.src||"string"!=typeof c.src)throw new Error("Missing or invalid src property. Check your image(s) object(s)");l=c.src,c.onload&&"function"==typeof c.onload&&(o=c.onload),c.onerror&&"function"==typeof c.onerror&&(q=c.onerror),g[e]=new Image,g[e].name=e,g[e].onload=function(){b(e,l,o)},g[e].onerror=function(b){j+=1,q.call(this,b),h+j===i&&(k=!1,m.call(a,{code:0,errors:j}),n.warn("Load process",f,"done with",j,"errors"),d(f))},g[e].src=l}var e=this,f="#"+o.generate(),g={},h=0,i=0,j=0,k=!1,l=u,m=u;this.getId=function(){return f},this.getProgress=function(){return h/i*100},this.isLoading=function(){return k},this.clear=function(){var a;for(a in g)g.hasOwnProperty(a)&&(g[a]=null,delete g[a]);e=null,g=null,h=null,i=null,j=null,k=null},this.load=function(a,b,d){var e;if(!k){h=0,k=!0,n.log("Load process",f,"started.");try{if(l=d||u,m=b||u,a instanceof Array)for(i=a.length,r+=i,e=0;i>e;e+=1)c(a[e]);else i+=1,r+=1,c(a)}catch(g){n.warn(g.message)}finally{return this}}return this}}function f(a){return p.hasOwnProperty(a)?p[a]:void 0}function g(a){var b=new Image;return p.hasOwnProperty(a)?(b.name=p[a].name,b.src=p[a].src,b):void 0}function h(){return q/r*100}function i(){return 0===t}function j(){var a,b;if(i()){for(a in p)p.hasOwnProperty(a)&&(p[a]=null,delete p[a]);for(b in s)s.hasOwnProperty(b)&&(s[b].clear(),s[b]=null,delete s[b]);return q=0,t=0,r=0,!0}return!1}function k(a,b,c){var d=new e;s[d.getId()]=d.load(a,b,c),t+=1}function l(a){p.hasOwnProperty(a)&&(p[a]=null,delete p[a]),q-=1,r-=1}function m(a){n=null,n=new b("[ImageManager]",a)}var n,o,p,q,r,s,t,u=function(){};return n=new b("[ImageManager]",0),o=new c,p={},q=0,r=0,s={},t=0,{load:k,getProgress:h,hasFinished:i,getImage:f,cloneImage:g,clear:j,cache:p,remove:l,debugMode:m}}();a.ImageManager=d}(function(){return this}());